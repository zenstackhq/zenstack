<!DOCTYPE html><html lang="en"><head>
        <meta charset="UTF-8">
        <title>Evolving model with migration</title>
        <link rel="icon" href="_media/logo.png">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="keywords" content="fullstack,full-stack,web development,next.js,typescript,crud,authorization,access control">
        <meta name="description" content="A fullstack toolkit for building secure CRUD web apps with Next.js and Typescript. Save time writing boilerplate code and focus on building real features!">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">

        <meta property="og:image" content="https://zenstack.dev/_media/banner.png">

        <meta property="og:title" content="ZenStack - toolkit for building CRUD apps with Next.js + Typescript">

        <meta property="og:description" content="A full-stack toolkit made for front-end developers. Intuitive and flexible data modeling. No more boilerplate CRUD code.">

        <meta property="og:url" content="https://zenstackhq.github.io/zenstack">

        <meta name="twitter:card" content="summary_large_image">

        <meta property="twitter:image:src" content="https://zenstack.dev/_media/banner.png">

        <meta property="twitter:title" content="ZenStack - toolkit for building CRUD apps with Next.js + Typescript">

        <meta property="twitter:description" content="A full-stack toolkit made for front-end developers. Intuitive and flexible data modeling. No more boilerplate CRUD code.">

        <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/docsify@4/lib/themes/vue.css">
    <style type="text/css">.docsify-copy-code-button,.docsify-copy-code-button span{cursor:pointer;transition:all .25s ease}.docsify-copy-code-button{position:absolute;z-index:1;top:0;right:0;overflow:visible;padding:.65em .8em;border:0;border-radius:0;outline:0;font-size:1em;background:grey;background:var(--theme-color,grey);color:#fff;opacity:0}.docsify-copy-code-button span{border-radius:3px;background:inherit;pointer-events:none}.docsify-copy-code-button .error,.docsify-copy-code-button .success{position:absolute;z-index:-100;top:50%;right:0;padding:.5em .65em;font-size:.825em;opacity:0;-webkit-transform:translateY(-50%);transform:translateY(-50%)}.docsify-copy-code-button.error .error,.docsify-copy-code-button.success .success{right:100%;opacity:1;-webkit-transform:translate(-115%,-50%);transform:translate(-115%,-50%)}.docsify-copy-code-button:focus,pre:hover .docsify-copy-code-button{opacity:1}</style><style>
.sidebar {
  padding-top: 0;
}

.search {
  margin-bottom: 20px;
  padding: 6px;
  border-bottom: 1px solid #eee;
}

.search .input-wrap {
  display: flex;
  align-items: center;
}

.search .results-panel {
  display: none;
}

.search .results-panel.show {
  display: block;
}

.search input {
  outline: none;
  border: none;
  width: 100%;
  padding: 0.6em 7px;
  font-size: inherit;
  border: 1px solid transparent;
}

.search input:focus {
  box-shadow: 0 0 5px var(--theme-color, #42b983);
  border: 1px solid var(--theme-color, #42b983);
}

.search input::-webkit-search-decoration,
.search input::-webkit-search-cancel-button,
.search input {
  -webkit-appearance: none;
  -moz-appearance: none;
  appearance: none;
}

.search input::-ms-clear {
  display: none;
  height: 0;
  width: 0;
}

.search .clear-button {
  cursor: pointer;
  width: 36px;
  text-align: right;
  display: none;
}

.search .clear-button.show {
  display: block;
}

.search .clear-button svg {
  transform: scale(.5);
}

.search h2 {
  font-size: 17px;
  margin: 10px 0;
}

.search a {
  text-decoration: none;
  color: inherit;
}

.search .matching-post {
  border-bottom: 1px solid #eee;
}

.search .matching-post:last-child {
  border-bottom: 0;
}

.search p {
  font-size: 14px;
  overflow: hidden;
  text-overflow: ellipsis;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
}

.search p.empty {
  text-align: center;
}

.app-name.hide, .sidebar-nav.hide {
  display: none;
}</style></head>
    <body data-page="/evolving-model-with-migration.md" class="ready">
        <nav class="app-nav"><ul><li>  <a href="https://go.zenstack.dev/chat" target="_blank" rel="noopener" title="Live Chat">Live Chat</a></li></ul></nav><a href="https://github.com/zenstackhq/zenstack" target="_blank" class="github-corner" aria-label="View source on Github"><svg viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><section class="cover" style="background: linear-gradient(to left bottom, hsl(91, 100%, 85%) 0%,hsl(229, 100%, 85%) 100%)"><div class="mask"></div><div class="cover-main"><!--cover--></div></section><main><button class="sidebar-toggle" aria-label="Menu"><div class="sidebar-toggle-button"><span></span><span></span><span></span></div></button><aside class="sidebar"><div class="search"><div class="input-wrap">
      <input type="search" value="" aria-label="Search text" placeholder="Type to search">
      <div class="clear-button">
        <svg width="26" height="24">
          <circle cx="12" cy="12" r="11" fill="#ccc"></circle>
          <path stroke="white" stroke-width="2" d="M8.25,8.25,15.75,15.75"></path>
          <path stroke="white" stroke-width="2" d="M8.25,15.75,15.75,8.25"></path>
        </svg>
      </div>
    </div>
    <div class="results-panel"></div>
    </div><h1 class="app-name"><a class="app-name-link" data-nosearch="" href="/evolving-model-with-migration"><div style="display: flex; align-items: center;"><img src="_media/logo.png" style="width: 2rem; margin-left: 0.5rem; margin-right: 0.5rem;"> <span>ZenStack</span></div></a></h1><div class="sidebar-nav"><ul><li><p>Getting started</p><ul><li>  <a href="/quick-start" title="Quick start">Quick start</a></li><li>  <a href="/modeling-your-app" title="Modeling your app">Modeling your app</a></li><li>  <a href="/code-generation" title="Code generation">Code generation</a></li><li>  <a href="/building-your-app" title="Building your app">Building your app</a></li></ul></li><li><p>ZModel reference</p><ul><li>  <a href="/zmodel-overview" title="Overview">Overview</a></li><li>  <a href="/zmodel-data-source" title="Data source">Data source</a></li><li>  <a href="/zmodel-enum" title="Enum">Enum</a></li><li>  <a href="/zmodel-data-model" title="Data model">Data model</a></li><li>  <a href="/zmodel-attribute" title="Attribute">Attribute</a></li><li>  <a href="/zmodel-field" title="Field">Field</a></li><li>  <a href="/zmodel-relation" title="Relation">Relation</a></li><li>  <a href="/zmodel-access-policy" title="Access policy">Access policy</a></li><li>  <a href="/zmodel-field-constraint" title="Field constraint">Field constraint</a></li><li>  <a href="/zmodel-referential-action" title="Referential action">Referential action</a></li></ul></li><li><p>CLI reference</p><ul><li>  <a href="/cli-commands" title="Commands">Commands</a></li></ul></li><li><p>  <a href="/runtime-api" title="Runtime API">Runtime API</a></p></li><li><p>Guide</p><ul><li>  <a href="/choosing-a-database" title="Choosing a database">Choosing a database</a></li><li class="active">  <a href="/evolving-model-with-migration" title="Evolving model with migration">Evolving model with migration</a><ul class="app-sub-sidebar"><li><a class="section-link" href="/evolving-model-with-migration?id=for-a-newly-created-schemazmodel" title="For a newly created schema.zmodel">For a newly created schema.zmodel</a></li><li><a class="section-link" href="/evolving-model-with-migration?id=after-updating-an-existing-schemazmodel" title="After updating an existing schema.zmodel">After updating an existing schema.zmodel</a></li><li><a class="section-link" href="/evolving-model-with-migration?id=pushing-model-changes-to-database-without-creating-migration" title="Pushing model changes to database without creating migration">Pushing model changes to database without creating migration</a></li><li><a class="section-link" href="/evolving-model-with-migration?id=summary" title="Summary">Summary</a></li></ul></li><li>  <a href="/integrating-authentication" title="Integrating authentication">Integrating authentication</a></li><li>  <a href="/server-side-rendering" title="Server-side rendering">Server-side rendering</a></li><li>  <a href="/setup-logging" title="Set up logging">Set up logging</a></li><li>  <a href="/telemetry" title="Telemetry">Telemetry</a></li></ul></li><li><p>  <a href="/vscode-extension" title="VSCode extension">VSCode extension</a></p></li><li><p>  <a href="/reach-out" title="Reach out to the developers">Reach out to the developers</a></p></li><li><p>  <a href="/changelog" title="Changelog">Changelog</a></p></li></ul></div></aside><section class="content"><article class="markdown-section" id="main"><h1 id="evolving-model-with-migration"><a href="/evolving-model-with-migration?id=evolving-model-with-migration" data-id="evolving-model-with-migration" class="anchor"><span>Evolving model with migration</span></a></h1><p>When using ZenStack, your schema.zmodel file represents the current status of your app's data model and your database's schema. When you make changes to schema.zmodel, however, your data model drifts away from database schema. At your app's deployment time, such drift needs to be "fixed", and so that your database schema stays synchronized with your data model. This processing of "fixing" is called migration.</p><p>Here we summarize a few common scenarios and show how you should work on migration.</p><h2 id="for-a-newly-created-schemazmodel"><a href="/evolving-model-with-migration?id=for-a-newly-created-schemazmodel" data-id="for-a-newly-created-schemazmodel" class="anchor"><span>For a newly created schema.zmodel</span></a></h2><p>When you're just starting out a ZenStack project, you have an empty migration history. After creating schema.zmodel, adding a development datasource and adding some models, run the following command to bootstrap your migration history and synchronize your development database schema:</p><pre v-pre="" data-lang="bash"><code class="lang-bash">npx zenstack migrate dev -n init</code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span class="error">Error</span><span class="success">Copied</span></button></pre><p>After it's run, you should find a folder named <code>migrations</code> created under <code>zenstack</code> folder, inside of which you can find a .sql file containing script that initializes your database. Please note that when you run "migration dev", the generated migration script is automatically run agains your datasource specified in schema.zmodel.</p><p>Make sure you commit the <code>migrations</code> folder into source control.</p><h2 id="after-updating-an-existing-schemazmodel"><a href="/evolving-model-with-migration?id=after-updating-an-existing-schemazmodel" data-id="after-updating-an-existing-schemazmodel" class="anchor"><span>After updating an existing schema.zmodel</span></a></h2><p>After making update to schema.zmodel, run the "migrate dev" command to generate an incremental migration record:</p><pre v-pre="" data-lang="bash"><code class="lang-bash">npx zenstack migrate dev -n [short-name-for-the-change]</code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span class="error">Error</span><span class="success">Copied</span></button></pre><p>If any database schema change is needed based on the previous version of data model, a new .sql file will be generated under <code>zenstack/migrations</code> folder. Your development database's schema is automatically synchronized after running the command.</p><p>Make sure you review that the generated .sql script reflects your intention before committing it to source control.</p><h2 id="pushing-model-changes-to-database-without-creating-migration"><a href="/evolving-model-with-migration?id=pushing-model-changes-to-database-without-creating-migration" data-id="pushing-model-changes-to-database-without-creating-migration" class="anchor"><span>Pushing model changes to database without creating migration</span></a></h2><p>This is helpful when you're prototyping locally and don't want to create migration records. Simply run:</p><pre v-pre="" data-lang="bash"><code class="lang-bash">npx zenstack db push</code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span class="error">Error</span><span class="success">Copied</span></button></pre><p>, and your database schema will be synced with schema.zmodel. After prototyping, reset your local database and generate migration records:</p><pre v-pre="" data-lang="bash"><code class="lang-bash">npx zenstack migrate reset</code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span class="error">Error</span><span class="success">Copied</span></button></pre><pre v-pre="" data-lang="bash"><code class="lang-bash">npx zenstack migrate dev -n [name]</code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span class="error">Error</span><span class="success">Copied</span></button></pre><h3 id="during-deployment"><a href="/evolving-model-with-migration?id=during-deployment" data-id="during-deployment" class="anchor"><span>During deployment</span></a></h3><p>When deploying your app to an official environment (a shared dev environment, staging, or production), <strong>DO NOT</strong> run <code>migrate dev</code> command in CI scripts. Instead, run <code>migrate deploy</code>.</p><pre v-pre="" data-lang="bash"><code class="lang-bash">npx zenstack migrate deploy</code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span class="error">Error</span><span class="success">Copied</span></button></pre><p>The <code>migrate deploy</code> command does not generate new migration records. It simply detects records that are created after the previous deployment and execute them in order. As a result, your database schema is synchronized with data model.</p><p>If you've always been taking the "migrate dev" and "migrate deploy" loop during development, your migration should run smoothly. However manually changing db schema, manually changing/deleting migration records can result in failure during migration. Please refer to this documentation for <a href="https://www.prisma.io/docs/guides/database/production-troubleshooting" target="_blank" rel="noopener">troubleshooting migration issues in production</a>.</p><h2 id="summary"><a href="/evolving-model-with-migration?id=summary" data-id="summary" class="anchor"><span>Summary</span></a></h2><p>ZenStack is built over <a href="https://www.prisma.io" target="blank">Prisma</a> and it internally delegates all ORM tasks to Prisma. The migration workflow is exactly the same as Prisma's workflow, with the only exception that the source of input is schema.zmodel, and a Prisma schema is generated on the fly. The set of migration commands that ZModel CLI offers, like "migrate dev" and "migrate deploy", are simple wrappers around Prisma commands.</p><p>Prisma has <a href="https://www.prisma.io/docs/concepts/components/prisma-migrate" target="blank">excellent documentation</a> about migration. Make sure you look into those for a more thorough understanding.</p></article></section></main>
        
        <!-- Docsify v4 -->
        
        
        
        
        
        
        
    

    <style>
        img[alt='cover-logo'] {
            width: 8rem;
        }
    </style>

<div class="progress" style="opacity: 0; width: 0%;"></div></body></html>